<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½œä¸šä¸Šä¼ æµ‹è¯• (Cloudflare Worker)</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è‡ªå®šä¹‰åŠ è½½åŠ¨ç”» */
        .loader {
            border-top-color: #3498db;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased">

    <div class="container mx-auto max-w-2xl p-6">
        <div class="bg-white rounded-lg shadow-xl p-8 mt-10">
            <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">
                ğŸ“š ä½œä¸šæ‰¹æ”¹ Worker æµ‹è¯•
            </h1>

            <form id="uploadForm" class="space-y-6">
                <div>
                    <label for="workerUrl" class="block text-sm font-medium text-gray-700 mb-1">
                        Worker URL:
                    </label>
                    <input 
                        type="text" 
                        id="workerUrl" 
                        name="workerUrl" 
                        placeholder="ä¾‹å¦‚: https://homework-grader.your-account.workers.dev" 
                        required 
                        class="w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    >
                </div>

                <div>
                    <label for="homeworkFile" class="block text-sm font-medium text-gray-700 mb-1">
                        é€‰æ‹©ä½œä¸š .zip åŒ…:
                    </label>
                    <input 
                        type="file" 
                        id="homeworkFile" 
                        name="homeworkFile" 
                        accept=".zip" 
                        required 
                        class="w-full text-sm text-gray-500
                               file:mr-4 file:py-2 file:px-4
                               file:rounded-md file:border-0
                               file:text-sm file:font-semibold
                               file:bg-blue-50 file:text-blue-700
                               hover:file:bg-blue-100
                               focus:outline-none"
                    >
                </div>

                <button 
                    type="submit" 
                    id="submitButton" 
                    class="w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"
                >
                    <span id="buttonText">ä¸Šä¼ å¹¶æ‰¹æ”¹</span>
                    <div id="loadingSpinner" class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-6 w-6 ml-3 hidden"></div>
                </button>
            </form>

            <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
            <div id="resultContainer" class="mt-6 hidden">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">å¤„ç†ç»“æœ:</h2>
                <pre id="resultOutput" class="bg-gray-900 text-white text-sm rounded-md p-4 overflow-x-auto"></pre>
            </div>
        </div>
    </div>

    <script>
        const uploadForm = document.getElementById('uploadForm');
        const submitButton = document.getElementById('submitButton');
        const buttonText = document.getElementById('buttonText');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const resultContainer = document.getElementById('resultContainer');
        const resultOutput = document.getElementById('resultOutput');
        const workerUrlInput = document.getElementById('workerUrl');
        const fileInput = document.getElementById('homeworkFile');

        // åœ¨é¡µé¢åŠ è½½æ—¶å°è¯•ä» localStorage åŠ è½½ URL
        workerUrlInput.value = localStorage.getItem('workerUrl') || '';

        uploadForm.addEventListener('submit', async (event) => {
            event.preventDefault(); // é˜»æ­¢è¡¨å•é»˜è®¤æäº¤

            const workerUrl = workerUrlInput.value.trim();
            const file = fileInput.files[0];

            if (!workerUrl || !file) {
                alert('è¯·å¡«å†™ Worker URL å¹¶é€‰æ‹©ä¸€ä¸ª .zip æ–‡ä»¶ã€‚');
                return;
            }
            
            // ä¿å­˜ URL åˆ° localStorage ä»¥ä¾¿ä¸‹æ¬¡ä½¿ç”¨
            localStorage.setItem('workerUrl', workerUrl);

            // ç¦ç”¨æŒ‰é’®å¹¶æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            submitButton.disabled = true;
            buttonText.textContent = 'å¤„ç†ä¸­...';
            loadingSpinner.classList.remove('hidden');
            resultContainer.classList.add('hidden');

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch(workerUrl, {
                    method: 'POST',
                    body: formData,
                });

                const resultText = await response.text();

                // æ˜¾ç¤ºç»“æœ
                resultContainer.classList.remove('hidden');
                
                if (response.ok) {
                    // å°è¯•è§£æ JSON
                    try {
                        const jsonResult = JSON.parse(resultText);
                        resultOutput.textContent = JSON.stringify(jsonResult, null, 2);
                        resultOutput.classList.remove('text-red-400');
                        resultOutput.classList.add('text-white');
                    } catch (e) {
                        // å¦‚æœä¸æ˜¯ JSONï¼Œå°±æ˜¾ç¤ºåŸå§‹æ–‡æœ¬
                        resultOutput.textContent = resultText;
                        resultOutput.classList.remove('text-red-400');
                        resultOutput.classList.add('text-white');
                    }
                } else {
                    // å¤„ç†é”™è¯¯
                    resultOutput.textContent = `é”™è¯¯ ${response.status}: ${resultText}`;
                    resultOutput.classList.remove('text-white');
                    resultOutput.classList.add('text-red-400');
                }

            } catch (error) {
                // å¤„ç†ç½‘ç»œæˆ–å…¶ä»– fetch é”™è¯¯
                resultContainer.classList.remove('hidden');
                resultOutput.textContent = `Fetch é”™è¯¯: ${error.message}\n\nè¯·æ£€æŸ¥ Worker URL æ˜¯å¦æ­£ç¡®ï¼Œä»¥åŠ Worker æ˜¯å¦å·²æˆåŠŸéƒ¨ç½²ã€‚`;
                resultOutput.classList.remove('text-white');
                resultOutput.classList.add('text-red-400');
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                submitButton.disabled = false;
                buttonText.textContent = 'ä¸Šä¼ å¹¶æ‰¹æ”¹';
                loadingSpinner.classList.add('hidden');
            }
        });
    </script>

</body>
</html>

